CC=gcc
CFLAGS=-c -m64 -O2 -fPIC -D_JNI_IMPLEMENTATION  -I headers/
LFLAGS=-m64 -fPIC -D_JNI_IMPLEMENTATION -lm -static-libgcc -shared
VERSION=1.0.1

release: setup-release \
		compile-release-pdftrick_native \
		compile-release-page_render \
		link-release

setup-release: 
				rm -rf dist/win/release 
				mkdir -p dist/win/release

compile-release-pdftrick_native:
				$(CC) $(CFLAGS) -o dist/win/release/pdftrick_native.o pdftrick_native.c

compile-release-page_render:
				$(CC) $(CFLAGS) -o dist/win/release/page_render.o page_render.c

link-release:
				$(CC) $(LFLAGS) \
				dist/win/release/pdftrick_native.o \
				dist/win/release/page_render.o \
				libs/win/libmupdf.a \
				libs/win/libfreetype.a \
				libs/win/libjbig2dec.a \
				libs/win/libjpeg.a \
				libs/win/libopenjpeg.a \
				libs/win/libz.a \
				-o dist/win/release/pdftrick-native-$(VERSION).dll

debug: setup-debug \
		compile-debug-pdftrick_native \
		compile-debug-page_render \
		link-debug

setup-debug:
				rm -rf dist/win/debug
				mkdir -p dist/win/debug

compile-debug-pdftrick_native:
				$(CC) $(CFLAGS) -g -o dist/win/debug/pdftrick_native.o pdftrick_native.c

compile-debug-page_render:
				$(CC) $(CFLAGS) -g -o dist/win/debug/page_render.o page_render.c

link-debug:
				$(CC) $(LFLAGS) \
				dist/win/debug/pdftrick_native.o \
				dist/win/debug/page_render.o \
				libs/win/libmupdf.a \
				libs/win/libfreetype.a \
				libs/win/libjbig2dec.a \
				libs/win/libjpeg.a \
				libs/win/libopenjpeg.a \
				libs/win/libz.a \
				-o dist/win/debug/pdftrick-native-$(VERSION).dll